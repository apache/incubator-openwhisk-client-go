#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

language: go

matrix:
    include:
        - os: linux
          sudo: required
          group: deprecated-2017Q3
          go: 1.8
          services: docker

git:
  depth: 3

notifications:
  email: false
  webhooks:
    urls:
      # travis2slack webhook to enable DMs on openwhisk-team.slack.com to PR authors with TravisCI results
      secure: "hWs0NBOu+ZpsB/7x/OpNOkvUH1cxgt8Ok312GhcQ64V+kh6XpeYhZX+qxgfUxdKlvbk/MlZd1TshwYzGybEiYuiFQtR4vL5CQ0SUVObrv0EnFKOgaVyCuIKuZldcEwmZBZw3ZeuNBEFoHJtv6JPcgLINOrS94WTiSxyeqCGLz8ScuieAKzvOZJwgqdDed8kA+J/QN/sIEfqg+gvs3yBEKDJ+85hsTB6s1EN7vuEuhv0Y6TZ9uMt8pxZRuD1MVfyl1CM8nS+IbgAxZPAR+AhBtU5P464w43wPunKuGhbSUoOSnEHMA8q3MM+CdWmhKKq4Rloyc0bbMz1vopJGnEFCS3MThsycfkWgY7AKHN9tNYID62IjSdcEbJVxBmKp5d23s3sjjia0K2VpJghWPiVZQJZLrh+yqyvVPRixJa9MJ3F58WtO/mmoDeWSC2eVyXfgO6FNJqrZ+i/LEKYkxhxr+x05fiJkkL6TIKvtRZLYId49N+yGeqKjzlxD2zp0FFRj5X+j1UfvUuVAOQP4feh/+UWjHs4Gz0LeeHTewf4Qm+IF40F/7hj4j9draxO3ELVhbWAGg0Nqs3aEbtW+OstGDLaMivOCRZK1OyCoKIdhFE9m9uColcmQZSsqHfSM4+OnbLFbcecJnRU0hmyU7kV2oc5f7gfqdJ6dkzziTfWc44U="

before_install:
  - cd $TRAVIS_BUILD_DIR
  - GO_FILES=$(find . -iname '*.go' -type f | grep -v /vendor/)
  - test -z "$(gofmt -s -l $(echo $GO_FILES))"
  - pip install --upgrade pip setuptools
  - ./tools/travis/setup.sh

install:
  - export DEPLOY_BUILD_READY=false
  - go get -u github.com/golang/lint/golint
  - go get -u github.com/stretchr/testify

script:
  - ./tools/travis/build.sh
  - export PATH=$PATH:$TRAVIS_BUILD_DIR;
  - make test
  - if [ "$TRAVIS_OS_NAME" == "linux" ] ; then
      ./tools/travis/test_openwhisk.sh;
    fi
